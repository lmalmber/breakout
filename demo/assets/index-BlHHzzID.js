var H=Object.defineProperty;var F=(n,i,t)=>i in n?H(n,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[i]=t;var s=(n,i,t)=>F(n,typeof i!="symbol"?i+"":i,t);(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))e(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const p of r.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&e(p)}).observe(document,{childList:!0,subtree:!0});function t(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function e(o){if(o.ep)return;o.ep=!0;const r=t(o);fetch(o.href,r)}})();class y{constructor(i,t){s(this,"entity");s(this,"name");this.entity=i,this.name=t}initialize(){}update(i){}draw(i){}}class c{constructor(i=0,t=0){this.x=i,this.y=t}add(i){return new c(this.x+i.x,this.y+i.y)}subtract(i){return new c(this.x-i.x,this.y-i.y)}multiply(i){return new c(this.x*i,this.y*i)}divide(i){return new c(this.x/i,this.y/i)}normalize(){const i=this.length();return i===0?new c(0,0):new c(this.x/i,this.y/i)}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}}const h=Symbol("transform");class x extends y{constructor(t,e){super(t,"transform");s(this,"position");s(this,"rotation");s(this,"scale");this.position=structuredClone(e==null?void 0:e.position)??new c(0,0),this.rotation=(e==null?void 0:e.rotation)??0,this.scale=structuredClone(e==null?void 0:e.scale)??new c(1,1)}}const C=Symbol("boxCollider");class P extends y{constructor(t,e){super(t,"boxCollider");s(this,"size");this.size=structuredClone(e)}intersects(t){const e=this.entity.getComponent(h),o=t.entity.getComponent(h);return!e||!o?!1:!(e.position.x+this.size.x<o.position.x||e.position.x>o.position.x+t.size.x||e.position.y+this.size.y<o.position.y||e.position.y>o.position.y+t.size.y)}onCollisionEnter(t){this.entity.emitEvent("collisionEnter",t)}}class D{constructor(){s(this,"previousCollisions",new Set)}update(i){const t=new Set;for(let e=0;e<i.length;e++){const o=i[e];if(!o.isActive)continue;const r=o.getComponent(C);if(r)for(let p=e+1;p<i.length;p++){const d=i[p];if(!d.isActive)continue;const w=d.getComponent(C);if(w&&r.intersects(w)){const v=this.getCollisionKey(o,d);t.add(v),this.previousCollisions.has(v)||(r.onCollisionEnter(d),w.onCollisionEnter(o))}}}this.previousCollisions=t}getCollisionKey(i,t){return[i.id,t.id].sort().join(":")}}class A{constructor(){s(this,"entities");s(this,"collisionSystem");this.entities=[],this.collisionSystem=new D}initialize(){this.entities.forEach(i=>i.initialize())}update(i){this.entities.forEach(t=>{t.isActive&&(t.isInitialized||t.initialize(),t.update(i))}),this.collisionSystem.update(this.entities)}draw(i){this.entities.forEach(t=>{t.isActive&&t.draw(i)})}addEntity(i){this.entities.push(i)}removeEntity(i){this.entities=this.entities.filter(t=>t.id!==i.id)}getEntity(i){return this.entities.find(t=>t.id===i.id)}getEntityByName(i){return this.entities.find(t=>t.name===i)}getEntitiesByName(i){return this.entities.filter(t=>t.name===i)}getAllEntities(){return this.entities}}class _{constructor(){s(this,"canvas");s(this,"context");s(this,"width");s(this,"height");s(this,"backgroundColor","#fff");const i=document.getElementById("canvas");if(!i)throw new Error("Canvas not found");const t=i.getContext("2d");if(!t)throw new Error("2d context not supported");this.canvas=i,this.context=t,this.width=this.canvas.width,this.height=this.canvas.height}clearCanvas(){this.context.clearRect(0,0,this.width,this.height),this.context.fillStyle=this.backgroundColor,this.context.fillRect(0,0,this.width,this.height)}drawRect(i,t,e,o,r){this.context.fillStyle=r,this.context.fillRect(i,t,e,o)}setBackgroundColor(i){this.backgroundColor=i}}class L{constructor(){s(this,"keysDown",new Set);s(this,"keysPressedThisFrame",new Set);document.addEventListener("keydown",i=>this.handleKeyDown(i)),document.addEventListener("keyup",i=>this.handleKeyUp(i))}clearState(){this.keysPressedThisFrame.clear()}isKeyPressedThisFrame(i){return this.keysPressedThisFrame.has(i)}isKeyHeldDown(i){return this.keysDown.has(i)}handleKeyDown(i){this.keysDown.has(i.key)||this.keysPressedThisFrame.add(i.key),this.keysDown.add(i.key)}handleKeyUp(i){this.keysDown.delete(i.key)}}const u=class u{static setGraphics(i){u._graphics=i}static getGraphics(){return u._graphics}static setInput(i){u._input=i}static getInput(){return u._input}static setEvents(i){u._events=i}static getEvents(){return u._events}};s(u,"_graphics"),s(u,"_input"),s(u,"_events");let a=u;class I{constructor(){s(this,"events",new Map)}on(i,t){this.events.has(i)||this.events.set(i,[]);const e=this.events.get(i);e&&e.push(t)}emit(i,t){var e;(e=this.events.get(i))==null||e.forEach(o=>o(t))}}class N{constructor(){s(this,"timeLastFrame",0);s(this,"scene",new A);s(this,"graphics",new _);s(this,"input",new L);a.setGraphics(this.graphics),a.setInput(this.input),a.setEvents(new I)}start(i){this.scene=i,this.scene.initialize(),requestAnimationFrame(this.run.bind(this))}run(i){const t=(i-this.timeLastFrame)/1e3;this.timeLastFrame=i,this.graphics.clearCanvas(),this.scene.update(t),this.scene.draw(this.graphics),this.input.clearState(),requestAnimationFrame(this.run.bind(this))}}const l=[];for(let n=0;n<256;++n)l.push((n+256).toString(16).slice(1));function q(n,i=0){return(l[n[i+0]]+l[n[i+1]]+l[n[i+2]]+l[n[i+3]]+"-"+l[n[i+4]]+l[n[i+5]]+"-"+l[n[i+6]]+l[n[i+7]]+"-"+l[n[i+8]]+l[n[i+9]]+"-"+l[n[i+10]]+l[n[i+11]]+l[n[i+12]]+l[n[i+13]]+l[n[i+14]]+l[n[i+15]]).toLowerCase()}let E;const j=new Uint8Array(16);function X(){if(!E){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");E=crypto.getRandomValues.bind(crypto)}return E(j)}const W=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),O={randomUUID:W};function Y(n,i,t){var o;if(O.randomUUID&&!n)return O.randomUUID();n=n||{};const e=n.random??((o=n.rng)==null?void 0:o.call(n))??X();if(e.length<16)throw new Error("Random bytes length must be >= 16");return e[6]=e[6]&15|64,e[8]=e[8]&63|128,q(e)}function $(){return Y()}class f{constructor(i,t){s(this,"id");s(this,"name");s(this,"scene");s(this,"eventBus",new I);s(this,"components",new Map);s(this,"_isInitialized",!1);s(this,"_isActive",!0);this.id=$(),this.name=t,this.scene=i}initialize(){this.isInitialized||(this.components.forEach(i=>i.initialize()),this._isInitialized=!0)}update(i){this.isActive&&this.components.forEach(t=>t.update(i))}draw(i){this.isActive&&this.components.forEach(t=>t.draw(i))}addComponent(i,t){this.components.set(i,t)}removeComponent(i){this.components.delete(i)}getComponent(i){return this.components.get(i)}emitEvent(i,t){this.eventBus.emit(i,t)}onEvent(i,t){this.eventBus.on(i,t)}activate(){this._isActive=!0}deactivate(){this._isActive=!1}get isActive(){return this._isActive}get isInitialized(){return this._isInitialized}}const m={background:"#090a0c",particles:"#f0f8fa55",text:"#f0f8fa",ball:"#f0f8fa",paddle:"#f0f8fa",blocks:["#85c7de","#a0c4e2","#aed1e6","#c6dbf0","#cfe8ef"]},M=Symbol("paddleGraphics");class J extends y{constructor(t,e){super(t,"paddleGraphics");s(this,"size");s(this,"transform");this.size=structuredClone(e)}initialize(){super.initialize(),this.transform=this.entity.getComponent(h)}draw(t){this.transform&&t.drawRect(this.transform.position.x,this.transform.position.y,this.size.x,this.size.y,m.paddle)}}const g=20,b=Symbol("physics");class K extends y{constructor(t,e){super(t,"physics");s(this,"velocity");s(this,"acceleration");s(this,"damping");s(this,"transform");this.velocity=structuredClone(e==null?void 0:e.velocity)??new c(0,0),this.acceleration=structuredClone(e==null?void 0:e.acceleration)??new c(0,0),this.damping=(e==null?void 0:e.damping)??1}initialize(){super.initialize(),this.transform=this.entity.getComponent(h)}update(t){this.transform&&(this.velocity.x+=this.acceleration.x*t,this.velocity.y+=this.acceleration.y*t,this.velocity.x*=this.damping,this.velocity.y*=this.damping,this.transform.position.x+=this.velocity.x*t,this.transform.position.y+=this.velocity.y*t)}}const Q=Symbol("paddleInput");class Z extends y{constructor(t){super(t,"paddleInput");s(this,"speed",500);s(this,"input");s(this,"graphics");s(this,"physics");s(this,"transform");s(this,"paddleGraphics")}initialize(){super.initialize(),this.input=a.getInput(),this.graphics=a.getGraphics(),this.physics=this.entity.getComponent(b),this.transform=this.entity.getComponent(h),this.paddleGraphics=this.entity.getComponent(M)}update(){this.handleMovement(),this.clampToScreen()}handleMovement(){if(!this.transform||!this.input||!this.physics)return;const t=this.input.isKeyHeldDown("ArrowLeft")||this.input.isKeyHeldDown("a"),e=this.input.isKeyHeldDown("ArrowRight")||this.input.isKeyHeldDown("d");t?this.physics.velocity.x=-this.speed:e?this.physics.velocity.x=this.speed:this.physics.velocity.x=0}clampToScreen(){if(!this.transform||!this.paddleGraphics||!this.graphics)return;this.transform.position.x<0+g&&(this.transform.position.x=0+g),this.transform.position.x>this.graphics.width-g-this.paddleGraphics.size.x&&(this.transform.position.x=this.graphics.width-g-this.paddleGraphics.size.x)}}class V extends f{constructor(t){super(t,"paddle");s(this,"size",new c(100,15));this.addComponent(h,new x(this)),this.addComponent(b,new K(this)),this.addComponent(C,new P(this,this.size)),this.addComponent(Q,new Z(this)),this.addComponent(M,new J(this,this.size))}initialize(){super.initialize();const t=a.getGraphics(),e=this.getComponent(h);e&&(e.position.x=t.width/2-this.size.x/2,e.position.y=t.height-g-this.size.y)}}const tt=Symbol("ballGraphics");class it extends y{constructor(t,e){super(t,"ballGraphics");s(this,"size");s(this,"transform");this.size=structuredClone(e)}initialize(){super.initialize(),this.transform=this.entity.getComponent(h)}draw(t){this.transform&&t.drawRect(this.transform.position.x,this.transform.position.y,this.size.x,this.size.y,m.ball)}}function k(n,i){const t=Math.ceil(Math.min(n,i)),e=Math.floor(Math.max(n,i));return Math.floor(Math.random()*(e-t+1))+t}function et(n,i){return Math.random()*(i-n)+n}function st(n,i,t){return Math.min(Math.max(n,i),t)}const nt=Symbol("ballPhysics");class ot extends y{constructor(t){super(t,"ballPhysics");s(this,"speed",550);s(this,"transform");s(this,"physics");s(this,"graphics");t.onEvent("collisionEnter",e=>this.handleCollision(e))}initialize(){super.initialize(),this.graphics=a.getGraphics(),this.transform=this.entity.getComponent(h),this.physics=this.entity.getComponent(b),this.physics&&(this.physics.velocity.x=k(-this.speed,this.speed),this.physics.velocity.y=-this.speed,this.physics.velocity=this.physics.velocity.normalize().multiply(this.speed))}update(){this.clampToScreen()}handleCollision(t){if(this.physics){if(t.name==="paddle"){const e=t.getComponent(b);if(!e)return;const o=.5;this.physics.velocity.x+=e.velocity.x*o}this.physics.velocity.y=-this.physics.velocity.y,this.physics.velocity=this.physics.velocity.normalize().multiply(this.speed)}}clampToScreen(){if(!this.transform||!this.graphics||!this.physics)return;const t=this.entity;this.transform.position.x<0&&(this.transform.position.x=0,this.physics.velocity.x=-this.physics.velocity.x),this.transform.position.y<0&&(this.transform.position.y=0,this.physics.velocity.y=-this.physics.velocity.y),this.transform.position.x+t.width>this.graphics.width&&(this.transform.position.x=this.graphics.width-t.width,this.physics.velocity.x=-this.physics.velocity.x),this.transform.position.y+t.height>this.graphics.height&&a.getEvents().emit("ballOffScreen")}}class rt extends f{constructor(t){super(t,"ball");s(this,"width",20);s(this,"height",20);this.addComponent(h,new x(this)),this.addComponent(b,new K(this)),this.addComponent(C,new P(this,new c(this.width,this.height))),this.addComponent(tt,new it(this,new c(this.width,this.height))),this.addComponent(nt,new ot(this))}initialize(){super.initialize();const t=a.getGraphics(),e=this.getComponent(h);e&&t&&(e.position.x=t.width/2-this.width/2,e.position.y=t.height-this.height-50)}}class z{constructor(i){s(this,"scene");this.scene=i}enter(i){}exit(){}update(i){}}const S=Symbol("text");class U extends y{constructor(t,e,o,r="white"){super(t,"text");s(this,"text");s(this,"fontSize");s(this,"_color");s(this,"transform");this.text=e,this.fontSize=o,this._color=r}initialize(){if(super.initialize(),this.transform=this.entity.getComponent(h),!this.transform)throw new Error("Text component requires a transform component")}draw(t){this.transform&&(t.context.font=`${this.fontSize} Courier New`,t.context.fillStyle=this._color,t.context.textAlign="center",t.context.textBaseline="middle",t.context.fillText(this.text,this.transform.position.x,this.transform.position.y))}get color(){return this._color}set color(t){this._color=t}}class T extends f{constructor(i,t){super(i,"headingText"),this.addComponent(h,new x(this)),this.addComponent(S,new U(this,t.toUpperCase(),"42px",m.text))}initialize(){super.initialize();const i=a.getGraphics(),t=this.getComponent(h);t&&(t.position.x=i.width/2,t.position.y=280)}}class ht{constructor(i,t,e=!1){s(this,"elapsedTime",0);s(this,"interval");s(this,"callback");s(this,"_isOneOff");s(this,"_hasTriggered",!1);this.interval=i,this.callback=t,this._isOneOff=e}update(i){this.isOneOff&&this.hasTriggered||(this.elapsedTime+=i,this.elapsedTime>=this.interval&&(this.callback(),this.elapsedTime=0,this._isOneOff&&(this._hasTriggered=!0)))}get isOneOff(){return this._isOneOff}get hasTriggered(){return this._hasTriggered}}class B extends f{constructor(t,e){super(t,"subheadingText");s(this,"blinkTimer");this.addComponent(h,new x(this)),this.addComponent(S,new U(this,e,"18px",m.text)),this.blinkTimer=new ht(.8,()=>this.handleBlink())}initialize(){super.initialize();const t=a.getGraphics(),e=this.getComponent(h);e&&(e.position.x=t.width/2,e.position.y=350)}update(t){super.update(t),this.blinkTimer.update(t)}handleBlink(){const t=this.getComponent(S);t&&(t.color===m.text?t.color=m.background:t.color=m.text)}}class at extends z{constructor(t){super(t);s(this,"title");s(this,"prompt");s(this,"input");this.input=a.getInput(),this.title=new T(t,"Game Over"),t.addEntity(this.title),this.prompt=new B(t,"Press Space to Try Again"),t.addEntity(this.prompt)}update(){if(this.input.isKeyPressedThisFrame(" "))return new G(this.scene)}exit(){this.title.deactivate(),this.prompt.deactivate()}}class ct extends z{constructor(t){super(t);s(this,"title");s(this,"prompt");s(this,"input");this.input=a.getInput(),this.title=new T(t,"Game Complete"),t.addEntity(this.title),this.prompt=new B(t,"Press Space to Play Again"),t.addEntity(this.prompt)}update(){if(this.input.isKeyPressedThisFrame(" "))return new G(this.scene)}exit(){this.title.deactivate(),this.prompt.deactivate()}}class G extends z{constructor(t){super(t);s(this,"ball");s(this,"isGameOver",!1);s(this,"isGameComplete",!1);this.ball=new rt(t),t.addEntity(this.ball);const e=a.getEvents();e.on("ballOffScreen",()=>this.isGameOver=!0),e.on("lastBlockHit",()=>this.isGameComplete=!0)}update(){if(this.isGameOver)return new at(this.scene);if(this.isGameComplete)return new ct(this.scene)}enter(){const t=this.scene.getEntityByName("blockContainer");t&&t.resetBlocks()}exit(){this.ball.deactivate()}}class lt extends z{constructor(t){super(t);s(this,"title");s(this,"prompt");s(this,"input");this.input=a.getInput(),this.title=new T(t,"Breakout"),t.addEntity(this.title),this.prompt=new B(t,"Press Space to Play"),t.addEntity(this.prompt)}update(){if(this.input.isKeyPressedThisFrame(" "))return new G(this.scene)}exit(){this.title.deactivate(),this.prompt.deactivate()}}const pt=Symbol("blockGraphics");class dt extends y{constructor(t,e,o){super(t,"blockGraphics");s(this,"width");s(this,"height");s(this,"color");s(this,"transform");this.width=e.x,this.height=e.y,this.color=o}initialize(){super.initialize(),this.transform=this.entity.getComponent(h)}draw(t){this.transform&&t.drawRect(this.transform.position.x,this.transform.position.y,this.width,this.height,this.color)}}const ut=Symbol("blockPhysics");class mt extends y{constructor(i){super(i,"blockPhysics"),i.onEvent("collisionEnter",()=>this.handleCollision())}handleCollision(){this.entity.deactivate(),this.entity.scene.getEntitiesByName("block").filter(t=>t.isActive).length===0&&a.getEvents().emit("lastBlockHit")}}class yt extends f{constructor(i,t,e){super(i,"block"),this.addComponent(h,new x(this)),this.addComponent(pt,new dt(this,t,e)),this.addComponent(C,new P(this,new c(t.x,t.y))),this.addComponent(ut,new mt(this))}}class ft extends f{constructor(t){super(t,"blockContainer");s(this,"rows",5);s(this,"columns",8);s(this,"blockMarginX",10);s(this,"blockMarginY",10);s(this,"blockHeight",20);this.addComponent(h,new x(this)),this.createBlocks(t).forEach(o=>this.scene.addEntity(o))}resetBlocks(){this.scene.getEntitiesByName("block").forEach(t=>t.activate())}createBlocks(t){const o=(a.getGraphics().width-g*2-this.blockMarginX*(this.columns-1))/this.columns,r=[];for(let p=0;p<this.rows;p++)for(let d=0;d<this.columns;d++){const w=new yt(t,new c(o,this.blockHeight),m.blocks[p]),v=w.getComponent(h);v&&(v.position.x=g+d*o+d*this.blockMarginX,v.position.y=g+p*this.blockHeight+p*this.blockMarginY),r.push(w)}return r}}class gt extends f{constructor(t,e){super(t,"particle");s(this,"lifetime",1);s(this,"size",1);s(this,"color","white");s(this,"updateHook",null);s(this,"inUse",!1);s(this,"next",null);this.addComponent(h,new x(this)),this.configure(e)}configure(t={}){const e=this.getComponent(h);e&&(e.position=structuredClone(t.position)??new c),this.lifetime=t.lifetime??1,this.size=t.size??1,this.color=t.color??"white",this.updateHook=t.updateHook??null}update(t){if(this.inUse&&(this.updateHook&&this.updateHook(t,this),this.lifetime!=="infinite"&&(this.lifetime-=t,this.lifetime<=0)))return this.inUse=!1,!0}}class xt extends f{constructor(t,e){super(t,"particleSystem");s(this,"maxParticles");s(this,"particlePool",[]);s(this,"firstAvailable",null);this.maxParticles=e;for(let o=0;o<this.maxParticles;o++)this.particlePool.push(new gt(t));this.firstAvailable=this.particlePool[0];for(let o=0;o<this.particlePool.length-1;o++)this.particlePool[o].next=this.particlePool[o+1];this.particlePool[this.maxParticles-1].next=null}spawnParticle(t){if(!this.firstAvailable)return;const e=this.firstAvailable;this.firstAvailable=e.next,e.next=null,e.configure(t),e.inUse=!0}update(t){this.particlePool.forEach(e=>{if(!e.inUse)return;e.update(t)&&(e.inUse=!1,e.next=this.firstAvailable,this.firstAvailable=e)})}draw(t){this.particlePool.forEach(e=>{if(!e.inUse)return;const o=e.getComponent(h);o&&(t.context.beginPath(),t.context.moveTo(o.position.x,o.position.y),t.context.rect(o.position.x,o.position.y,e.size,e.size),t.context.fillStyle=e.color,t.context.fill())})}}class wt extends f{constructor(i){super(i,"backgroundEffect")}initialize(){super.initialize();const i=a.getGraphics(),t=this.scene.getEntityByName("particleSystem");if(!i||!t)throw new Error("Failed to create background effect");for(let e=0;e<500;e++){const o=k(0,i.width),r=k(0,i.height);t.spawnParticle({position:new c(o,r),lifetime:"infinite",size:k(1,3),color:m.particles,updateHook:(p,d)=>{d.size+=et(-5,5)*p,d.size=st(d.size,1,3)}})}}}class vt extends A{constructor(){super();s(this,"state");this.state=new lt(this),this.addEntity(new xt(this,1e3)),this.addEntity(new wt(this)),this.addEntity(new V(this)),this.addEntity(new ft(this))}initialize(){super.initialize(),a.getGraphics().setBackgroundColor(m.background)}update(t){super.update(t);const e=this.state.update(t);e&&(this.state.exit(),this.state=e,this.state.enter(this))}}const R=document.querySelector("#app");if(!R)throw new Error("Failed to create app");R.innerHTML=`
    <div>
        <canvas width="800" height="600" id="canvas" style="border: 1px solid"></canvas>
    </div>
`;const Ct=new N;Ct.start(new vt);
